# AI CLI Preparation - direnv configuration

export PROJECT_NAME="${PROJECT_NAME:-$(basename "$PWD")}"

# Clear any conflicting VIRTUAL_ENV from other projects
# This project uses uv with its own .venv/
unset VIRTUAL_ENV

echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
echo "direnv: Loaded $PROJECT_NAME"
echo ""
echo "Package management: uv (always use 'uv run' for Python commands)"
echo ""
echo "Quick start:"
echo "  uv sync --extra dev           - Install/sync dependencies"
echo "  uv run python -m pytest       - Run all tests"
echo "  uv run python audit.py --help - Show CLI options"
echo ""
echo "First time? Run: uv sync --extra dev"
echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"

# Auto-sync uv dependencies if .venv is missing or stale
if command -v uv &> /dev/null; then
    if [ ! -d ".venv" ] || [ "pyproject.toml" -nt ".venv" ]; then
        echo "→ Running uv sync --extra dev..."
        uv sync --extra dev --quiet
    fi
fi

# Load environment files if they exist (Makefile handles this too)
# Uncomment if you want direnv to export these variables
# use dotenv .env.default
# use dotenv .env
